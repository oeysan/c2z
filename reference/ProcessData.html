<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Process data with Parallel Execution and Row/Chunk Processing — ProcessData • c2z</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Process data with Parallel Execution and Row/Chunk Processing — ProcessData"><meta name="description" content="This function processes a tibble (or data frame) in parallel using the future package
along with progressr for progress reporting. The data is split into chunks via a helper function
SplitData. Depending on the by.rows flag, each chunk is processed either row-by-row
(using lapply) or as an entire chunk. In either case, the processed results are bound into a single tibble."><meta property="og:description" content="This function processes a tibble (or data frame) in parallel using the future package
along with progressr for progress reporting. The data is split into chunks via a helper function
SplitData. Depending on the by.rows flag, each chunk is processed either row-by-row
(using lapply) or as an entire chunk. In either case, the processed results are bound into a single tibble."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">c2z</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9006</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/c2z_public.html">Public library</a></li>
    <li><a class="dropdown-item" href="../articles/c2z_vignette.html">Behold c2z!</a></li>
    <li><a class="dropdown-item" href="../articles/zotero_api.html">Create a Zotero API key</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../TODO.html">Todo</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="http://twitter.com/motsegn" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/oeysan/c2z/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Process data with Parallel Execution and Row/Chunk Processing</h1>
      <small class="dont-index">Source: <a href="https://github.com/oeysan/c2z/blob/main/R/process_data.R" class="external-link"><code>R/process_data.R</code></a></small>
      <div class="d-none name"><code>ProcessData.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function processes a tibble (or data frame) in parallel using the <code>future</code> package
along with <code>progressr</code> for progress reporting. The data is split into chunks via a helper function
<code>SplitData</code>. Depending on the <code>by.rows</code> flag, each chunk is processed either row-by-row
(using <code>lapply</code>) or as an entire chunk. In either case, the processed results are bound into a single tibble.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ProcessData</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">func</span>,</span>
<span>  by.rows <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min.multisession <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  n.workers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n.chunks <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  use.multisession <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  start.message <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  end.message <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  restore.defaults <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  handler <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  log <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data to be processed.</p></dd>


<dt id="arg-func">func<a class="anchor" aria-label="anchor" href="#arg-func"></a></dt>
<dd><p>A function that processes either a single row (if <code>by.rows = TRUE</code>) or an entire chunk
(if <code>by.rows = FALSE</code>). Additional arguments are passed to <code>func</code> via <code>...</code>.</p></dd>


<dt id="arg-by-rows">by.rows<a class="anchor" aria-label="anchor" href="#arg-by-rows"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, <code>func</code> is applied to each row individually within each chunk;
if <code>FALSE</code>, <code>func</code> is applied to the entire chunk. Default is <code>TRUE</code>.</p></dd>


<dt id="arg-min-multisession">min.multisession<a class="anchor" aria-label="anchor" href="#arg-min-multisession"></a></dt>
<dd><p>Integer. The minimum number of rows in <code>data</code> required to use multisession
(parallel execution). If <code>nrow(data)</code> is less than this value, parallel processing is disabled.
Default is <code>1</code>.</p></dd>


<dt id="arg-n-workers">n.workers<a class="anchor" aria-label="anchor" href="#arg-n-workers"></a></dt>
<dd><p>Integer. The number of workers to use for parallel processing.
Defaults to <code>max(1, future::availableCores() - 1)</code>.</p></dd>


<dt id="arg-n-chunks">n.chunks<a class="anchor" aria-label="anchor" href="#arg-n-chunks"></a></dt>
<dd><p>Integer. The number of chunks into which the data is split.
If <code>NULL</code>, it defaults to the number of workers.</p></dd>


<dt id="arg-limit">limit<a class="anchor" aria-label="anchor" href="#arg-limit"></a></dt>
<dd><p>Integer. If <code>(nrow(data) / limit)</code> is less than or equal to <code>n.workers</code>,
the data is split into <code>n.chunks</code>; otherwise, it is split using <code>limit</code>. Default is <code>100</code>.</p></dd>


<dt id="arg-use-multisession">use.multisession<a class="anchor" aria-label="anchor" href="#arg-use-multisession"></a></dt>
<dd><p>Logical. If <code>TRUE</code> (default) parallel processing is used; otherwise,
sequential processing is employed.</p></dd>


<dt id="arg-start-message">start.message<a class="anchor" aria-label="anchor" href="#arg-start-message"></a></dt>
<dd><p>Optional character string. A custom message to log at the start of processing.</p></dd>


<dt id="arg-end-message">end.message<a class="anchor" aria-label="anchor" href="#arg-end-message"></a></dt>
<dd><p>Optional character string. A custom message to log at the end of processing.</p></dd>


<dt id="arg-restore-defaults">restore.defaults<a class="anchor" aria-label="anchor" href="#arg-restore-defaults"></a></dt>
<dd><p>Logical. If <code>TRUE</code> (default), the original future plan and progress handlers
are restored after processing.</p></dd>


<dt id="arg-handler">handler<a class="anchor" aria-label="anchor" href="#arg-handler"></a></dt>
<dd><p>Character string. The progress handler to be used by the <code>progressr</code> package.
Defaults to <code>"txtprogressbar"</code> unless <code>silent</code> is <code>TRUE</code>.</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, progress messages and logging are suppressed. Default is <code>FALSE</code>.</p></dd>


<dt id="arg-log">log<a class="anchor" aria-label="anchor" href="#arg-log"></a></dt>
<dd><p>List. An initial log (default is an empty list) to which log messages are appended.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to the processing function <code>func</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with two components:</p><dl><dt>results</dt>
<dd><p>A tibble resulting from binding all processed rows from each chunk.</p></dd>

  <dt>log</dt>
<dd><p>A list of log messages generated during processing.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function first checks if the data has enough rows to warrant parallel processing.
It then determines the number of workers and chunks and splits the data using the helper function
<code>SplitData</code>. The processing is executed with <code><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future.apply::future_lapply</a></code> in parallel. If <code>by.rows</code> is <code>TRUE</code>,
each row within a chunk is processed individually and then bound together using <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">dplyr::bind_rows</a></code>;
if <code>by.rows</code> is <code>FALSE</code>, the entire chunk is processed at once. Finally, all chunk results are combined
into a single tibble.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">example.result</span> <span class="op">&lt;-</span> <span class="fu">ProcessData</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    key <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  func <span class="op">=</span> \<span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">data</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">value</span> <span class="op">*</span> <span class="fl">10</span></span></span>
<span class="r-in"><span>    <span class="va">data</span></span></span>
<span class="r-in"><span>  <span class="op">}</span>,</span></span>
<span class="r-in"><span>  by.rows <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  min.multisession <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  n.workers <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  n.chunks <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>  limit <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  use.multisession <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  start.message <span class="op">=</span> <span class="st">"Starting example data processing"</span>,</span></span>
<span class="r-in"><span>  end.message   <span class="op">=</span> <span class="st">"Finished example data processing"</span>,</span></span>
<span class="r-in"><span>  handler <span class="op">=</span> <span class="st">"txtprogressbar"</span>,</span></span>
<span class="r-in"><span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># The result is a single tibble.</span></span></span>
<span class="r-in"><span><span class="va">processed.tibble</span> <span class="op">&lt;-</span> <span class="va">example.result</span><span class="op">$</span><span class="va">results</span></span></span>
<span class="r-in"><span><span class="va">process.log</span> <span class="op">&lt;-</span> <span class="va">example.result</span><span class="op">$</span><span class="va">log</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">processed.tibble</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">processed.tibble</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Øystein Olav Skaar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

